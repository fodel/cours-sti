<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TD 2 : Gestion du Club de Robotique</title>
    
    <!-- Bootstrap et Font Awesome pour le style -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Styles spécifiques, réutilisés depuis le TD1 pour la cohérence -->
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; padding-top: 20px; padding-bottom: 80px; }
        .td-container { max-width: 1000px; margin: auto; background-color: #ffffff; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.1); overflow: hidden; }
        .td-header { background-color: #6f42c1; color: white; padding: 25px; text-align: center; }
        .td-header h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .td-header p { margin: 0; opacity: 0.9; }
        .content-section { padding: 30px; }
        .content-section h2 { color: #6f42c1; border-bottom: 2px solid #e9ecef; padding-bottom: 10px; margin-bottom: 20px; }
        .question-container { border: 1px solid #e9ecef; border-radius: 8px; margin-bottom: 20px; overflow: hidden; }
        .question-header { background-color: #f8f9fa; padding: 15px 20px; border-bottom: 1px solid #e9ecef; }
        .question-title { font-weight: bold; font-size: 1.1rem; margin: 0; }
        .question-content { padding: 20px; }
        .solution-block { background-color: #f0f8f0; border-top: 1px solid #e9ecef; padding: 20px; display: none; }
        .btn-solution-toggle { background-color: #198754; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: background-color 0.3s; }
        .btn-solution-toggle:hover { background-color: #157347; }
        .code-block { background-color: #2d2d2d; color: #f8f8f2; border-radius: 5px; padding: 15px; margin: 15px 0; font-family: 'Courier New', Courier, monospace; font-size: 0.9rem; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; }
        .table-responsive { margin: 20px 0; }
        .table th { background-color: #6f42c1; color: white; }
        .primary-key { text-decoration: underline; font-weight: bold; }
        .foreign-key { font-style: italic; color: #6c757d; }
    </style>
</head>
<body>
    <a href="../tds.html" style="margin: 10px 20px; display: inline-block;"><i class="fas fa-arrow-left"></i> Retour à la liste des TDs</a>
    
    <div class="td-container">
        <div class="td-header">
            <h1><i class="fas fa-robot"></i> TD 2 : Gestion du Club de Robotique</h1>
            <p>Exercices sur la modélisation, la création et la modification de bases de données SQL</p>
        </div>

        <!-- Partie 1: Énoncé Complet -->
        <section class="content-section">
            <h2>Énoncé</h2>
            <p>Le Club de Robotique du lycée est divisé en plusieurs équipes. Chaque équipe travaille sur des projets spécifiques. Les élèves peuvent appartenir à une équipe et participer à plusieurs projets à la fois. Chaque projet a un responsable qui est aussi un élève membre du club. La représentation textuelle de cette base est la suivante :</p>
            <div class="code-block">élève (<u>idEleve</u>, nom, prénom, email, idEquipe#)
equipe (<u>idEquipe</u>, nomEquipe, idProjet#)
projet(<u>idProjet</u>, nomProjet, responsable#, budget)
participation (<u>idEleve#</u>, idProjet#, rôle)</div>
            <p><em>Légende : <span class="primary-key">Clé primaire</span> | <span class="foreign-key">Clé étrangère</span></em></p>

            <p>La description des différents champs est présentée dans le tableau suivant :</p>
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr><td>idEleve</td><td>INT</td><td>Identifiant de l'élève</td></tr>
                        <tr><td>nom</td><td>VARCHAR(100)</td><td>Nom de l'élève. Champ obligatoire</td></tr>
                        <tr><td>prénom</td><td>VARCHAR(100)</td><td>Prénom de l'élève.</td></tr>
                        <tr><td>email</td><td>VARCHAR(255)</td><td>Adresse email unique de l'élève.</td></tr>
                        <tr><td>idEquipe</td><td>INT</td><td>Identifiant unique de chaque équipe</td></tr>
                        <tr><td>nomEquipe</td><td>VARCHAR(100)</td><td>Nom de l'équipe.</td></tr>
                        <tr><td>idProjet</td><td>INT</td><td>Identifiant unique de chaque projet.</td></tr>
                        <tr><td>nomProjet</td><td>VARCHAR(100)</td><td>Nom du projet.</td></tr>
                        <tr><td>responsable</td><td>INT</td><td>Identifiant de l'élève responsable du projet</td></tr>
                        <tr><td>budget</td><td>DECIMAL(10, 2)</td><td>Budget alloué pour le projet.</td></tr>
                        <tr><td>rôle</td><td>VARCHAR(5)</td><td>Rôle de l'étudiant dans le projet (ex: "Programmeur", "Designer").</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Partie 2: Liste des Questions -->
        <section class="content-section">
            <h2>Liste des Questions</h2>

            <!-- Question 1 -->
            <div class="question-container">
                <div class="question-header"><h3 class="question-title">Question 1</h3></div>
                <div class="question-content">
                    <p>Représenter graphiquement la base de données.</p>
                    <button class="btn-solution-toggle" onclick="toggleSolution('q1')">Afficher la correction</button>
                    <div class="solution-block" id="solution-q1">
                        <img src="q2TD2.PNG" alt="">
                    </div>
                </div>
            </div>

            <!-- Question 2 -->
            <div class="question-container">
                <div class="question-header"><h3 class="question-title">Question 2</h3></div>
                <div class="question-content">
                    <p>Écrire une requête SQL permettant de créer la table élèves avec tous ses contraintes.</p>
                    <button class="btn-solution-toggle" onclick="toggleSolution('q2')">Afficher la correction</button>
                    <div class="solution-block" id="solution-q2">
                        <h4><i class="fas fa-lightbulb"></i> Correction</h4>
                        <div class="file-name">SQL</div>
                        <div class="code-block">CREATE TABLE élève (
    idEleve INT PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    prénom VARCHAR(100),
    email VARCHAR(255) UNIQUE,
    idEquipe INT,
    FOREIGN KEY (idEquipe) REFERENCES equipe(idEquipe)
);</div>
                    </div>
                </div>
            </div>

            <!-- Question 3 -->
            <div class="question-container">
                <div class="question-header"><h3 class="question-title">Question 3</h3></div>
                <div class="question-content">
                    <p>Si un élève peut appartenir à plusieurs équipes simultanément, donnez la représentation textuelle de la table "Élèves" ainsi que toutes les nouvelles tables indispensables. Ajoutez un champ "dateAppartenance" pour indiquer la date à laquelle l'élève a rejoint chaque équipe.</p>
                    <button class="btn-solution-toggle" onclick="toggleSolution('q3')">Afficher la correction</button>
                    <div class="solution-block" id="solution-q3">
                        <h4><i class="fas fa-lightbulb"></i> Correction</h4>
                        <p>La table `élève` n'a plus de lien direct avec `equipe`. Il faut une table de liaison `appartenance`.</p>
                        <div class="file-name">Représentation Textuelle</div>
                        <div class="code-block">élève (<u>idEleve</u>, nom, prénom, email)
appartenance (<u>idEleve#</u>, <u>idEquipe#</u>, dateAppartenance)</div>
                        <p>Les requêtes SQL pour créer cette nouvelle table sont :</p>
                        <div class="file-name">SQL</div>
                        <div class="code-block">CREATE TABLE appartenance (
    idEleve INT,
    idEquipe INT,
    dateAppartenance DATE,
    PRIMARY KEY (idEleve, idEquipe),
    FOREIGN KEY (idEleve) REFERENCES élève(idEleve),
    FOREIGN KEY (idEquipe) REFERENCES equipe(idEquipe)
);


ALTER TABLE élève DROP COLUMN idEquipe;</div>
                    </div>
                </div>
            </div>

            <!-- Question 4 -->
            <div class="question-container">
                <div class="question-header"><h3 class="question-title">Question 4</h3></div>
                <div class="question-content">
                    <p>Le champ "budget" de la table "Projet" doit toujours avoir une valeur positive. Si l'utilisateur oublie de remplir ce champ, la valeur par défaut sera fixée à 100. Donnez une requête SQL permettant de créer cette contrainte.</p>
                    <button class="btn-solution-toggle" onclick="toggleSolution('q4')">Afficher la correction</button>
                    <div class="solution-block" id="solution-q4">
                        <h4><i class="fas fa-lightbulb"></i> Correction</h4>
                        <p>On utilise une contrainte `CHECK` pour la positivité et une valeur `DEFAULT`.</p>
                        <div class="file-name">SQL</div>
                        <div class="code-block">ALTER TABLE projet MODIFY COLUMN budget DECIMAL(10, 2) DEFAULT 100.00 CHECK (budget > 0);</div>
                    </div>
                </div>
            </div>

            <!-- Question 5 -->
            <div class="question-container">
                <div class="question-header"><h3 class="question-title">Question 5</h3></div>
                <div class="question-content">
                    <p>Le champs "idEquipe" de la table équipe est un entier auto incrémenté. Donnez une requête SQL permettant d'ajouter cette contrainte.</p>
                    <button class="btn-solution-toggle" onclick="toggleSolution('q5')">Afficher la correction</button>
                    <div class="solution-block" id="solution-q5">
                        <h4><i class="fas fa-lightbulb"></i> Correction</h4>
                        <p>On modifie la colonne pour y ajouter la propriété `AUTO_INCREMENT`.</p>
                        <div class="file-name">SQL</div>
                        <div class="code-block">ALTER TABLE equipe ALTER COLUMN idEquipe INT AUTO_INCREMENT;</div>
                    </div>
                </div>
            </div>

            <!-- Question 6 -->
            <div class="question-container">
                <div class="question-header"><h3 class="question-title">Question 6</h3></div>
                <div class="question-content">
                    <p>Donnez une requête SQL permettant d'ajouter le champs "DateCreation" à la table "équipe".</p>
                    <button class="btn-solution-toggle" onclick="toggleSolution('q6')">Afficher la correction</button>
                    <div class="solution-block" id="solution-q6">
                        <h4><i class="fas fa-lightbulb"></i> Correction</h4>
                        <div class="file-name">SQL</div>
                        <div class="code-block">ALTER TABLE equipe
ADD COLUMN DateCreation DATE;</div>
                    </div>
                </div>
            </div>

            <!-- Question 7 -->
            <div class="question-container">
                <div class="question-header"><h3 class="question-title">Question 7</h3></div>
                <div class="question-content">
                    <p>La contrainte nommée "pkParticipation" représente la clé primaire de la table "Participation". Cependant, cette contrainte ne permet pas à un élève de participer à plusieurs projets. Donnez les requêtes SQL permettant de supprimer cette contrainte et de créer une nouvelle clé primaire conforme à la règle autorisant un élève à participer à plusieurs projets.</p>
                    <button class="btn-solution-toggle" onclick="toggleSolution('q7')">Afficher la correction</button>
                    <div class="solution-block" id="solution-q7">
                        <h4><i class="fas fa-lightbulb"></i> Correction</h4>
                        <p>On suppose que l'ancienne clé primaire était sur `idEleve` seul. On la supprime et on en crée une nouvelle composée.</p>
                        <div class="file-name">SQL</div>
                        <div class="code-block">ALTER TABLE participation
DROP CONSTRAINT pkParticipation;

ALTER TABLE participation
ADD CONSTRAINT pk_participation PRIMARY KEY (idEleve, idProjet);</div>
                    </div>
                </div>
            </div>

            <!-- Question 8 -->
            <div class="question-container">
                <div class="question-header"><h3 class="question-title">Question 8</h3></div>
                <div class="question-content">
                    <p>Le champ "nomProjet" de la table "Projet" doit commencer par le mot "RB", suivi d'au moins trois lettres. Donnez une requête SQL permettant de créer cette contrainte de domaine.</p>
                    <button class="btn-solution-toggle" onclick="toggleSolution('q8')">Afficher la correction</button>
                    <div class="solution-block" id="solution-q8">
                        <h4><i class="fas fa-lightbulb"></i> Correction</h4>
                        <p>On utilise une contrainte `CHECK` avec l'opérateur `LIKE`.</p>
                        <div class="file-name">SQL</div>
                        <div class="code-block">ALTER TABLE projet
ADD CONSTRAINT chk_nom_projet CHECK (nomProjet LIKE 'RB___%');</div>
                    </div>
                </div>
            </div>

            <!-- Question 9 -->
            <div class="question-container">
                <div class="question-header"><h3 class="question-title">Question 9</h3></div>
                <div class="question-content">
                    <p>Les élèves doivent utiliser des adresses email du ministère de l'Éducation, dont le format est "ch@tarbia.tn", où "ch" est une chaîne de caractères non vide. Donnez la requête SQL permettant d’ajouter cette contrainte à la table appropriée.</p>
                    <button class="btn-solution-toggle" onclick="toggleSolution('q9')">Afficher la correction</button>
                    <div class="solution-block" id="solution-q9">
                        <h4><i class="fas fa-lightbulb"></i> Correction</h4>
                        <div class="file-name">SQL</div>
                        <div class="code-block">ALTER TABLE élève
ADD CONSTRAINT chk_email_education CHECK (email LIKE '_%@tarbia.tn');</div>
                    </div>
                </div>
            </div>

            <!-- Question 10 -->
            <div class="question-container">
                <div class="question-header"><h3 class="question-title">Question 10</h3></div>
                <div class="question-content">
                    <p>L'administration de l'école décide que le responsable d'un projet doit être un enseignant. Dans cette base de données, un enseignant est identifié par son adresse email, possède un nom et enseigne une matière. Donnez les requêtes SQL permettant de réaliser les changements nécessaires pour appliquer ces règles et contraintes.</p>
                    <button class="btn-solution-toggle" onclick="toggleSolution('q10')">Afficher la correction</button>
                    <div class="solution-block" id="solution-q10">
                        <h4><i class="fas fa-lightbulb"></i> Correction</h4>
                        <p>Il faut créer une table `enseignant` et modifier la table `projet` pour qu'elle référence cette nouvelle table.</p>
                        <div class="file-name">SQL</div>
                        <div class="code-block">-- 1. Créer la table enseignant
CREATE TABLE enseignant (
    email VARCHAR(255) PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    matière VARCHAR(100)
);

-- 2. Modifier la table projet
ALTER TABLE projet DROP COLUMN responsable;

ALTER TABLE projet ADD COLUMN emailEnseignant VARCHAR(255);

ALTER TABLE projet
ADD CONSTRAINT fk_projet_enseignant
FOREIGN KEY (emailEnseignant) REFERENCES enseignant(email);</div>
                    </div>
                </div>
            </div>

            <!-- Question 11 -->
            <div class="question-container">
                <div class="question-header"><h3 class="question-title">Question 11</h3></div>
                <div class="question-content">
                    <p>Après la création de la table "enseignant", l'administration de l'école constate une redondance au niveau du champ "matière".</p>
                    <p>a. Proposez une nouvelle description de la table "enseignant" ainsi que de toutes les nouvelles tables nécessaires pour normaliser cette base de données.</p>
                    <p>b. Donnez les requêtes SQL permettant de réaliser ces changements.</p>
                    <button class="btn-solution-toggle" onclick="toggleSolution('q11')">Afficher la correction</button>
                    <div class="solution-block" id="solution-q11">
                        <h4><i class="fas fa-lightbulb"></i> Correction</h4>
                        <p>a. Il faut créer une table `matiere` et lier `enseignant` à cette table.</p>
                        <div class="file-name">Représentation Textuelle</div>
                        <div class="code-block">matiere (<u>idMatiere</u>, nomMatiere)
enseignant (<u>email</u>, nom, <u>idMatiere#</u>)</div>
                        <p>b. Les requêtes SQL pour mettre en place cette nouvelle structure sont :</p>
                        <div class="file-name">SQL</div>
                        <div class="code-block">-- 1. Créer la table matiere
CREATE TABLE matiere (
    idMatiere INT PRIMARY KEY AUTO_INCREMENT,
    nomMatiere VARCHAR(100) NOT NULL UNIQUE
);

-- 2. Modifier la table enseignant
ALTER TABLE enseignant ADD COLUMN idMatiere INT;

ALTER TABLE enseignant
ADD CONSTRAINT fk_enseignant_matiere
FOREIGN KEY (idMatiere) REFERENCES matiere(idMatiere);

-- 3. Supprimer l'ancienne colonne matière
ALTER TABLE enseignant DROP COLUMN matière;</div>
                    </div>
                </div>
            </div>

            <!-- Question 12 -->
            <div class="question-container">
                <div class="question-header"><h3 class="question-title">Question 12</h3></div>
                <div class="question-content">
                    <p>Lors de l'insertion d'une ligne dans la table "Participation", l'administrateur remarque que la taille du champ est insuffisante pour contenir une description détaillée du rôle d'un élève dans un projet.</p>
                    <p>a. Quel type de données en SQL permet de contenir une chaîne sans spécifier de taille maximale ?</p>
                    <p>b. Donnez une requête SQL permettant de modifier le type de ce champ vers le nouveau type.</p>
                    <button class="btn-solution-toggle" onclick="toggleSolution('q12')">Afficher la correction</button>
                    <div class="solution-block" id="solution-q12">
                        <h4><i class="fas fa-lightbulb"></i> Correction</h4>
                        <p>a. Le type de données `TEXT` permet de stocker des chaînes de caractères de longueur variable sans avoir à spécifier une taille maximale.</p>
                        <p>b. On modifie la colonne `rôle` pour changer son type.</p>
                        <div class="file-name">SQL</div>
                        <div class="code-block">ALTER TABLE participation
MODIFY COLUMN rôle TEXT;</div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        function toggleSolution(questionId) {
            const solutionBlock = document.getElementById(`solution-${questionId}`);
            const button = document.querySelector(`#${questionId} .btn-solution-toggle`);
            if (solutionBlock.style.display === 'block') {
                solutionBlock.style.display = 'none';
                button.textContent = 'Afficher la correction';
            } else {
                solutionBlock.style.display = 'block';
                button.textContent = 'Masquer la correction';
            }
        }
    </script>
</body>
</html>