<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TD 5 : Gestion des Transports</title>
    
    <!-- Bootstrap et Font Awesome pour le style -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Styles spécifiques -->
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; padding-top: 20px; padding-bottom: 80px; }
        .td-container { max-width: 1000px; margin: auto; background-color: #ffffff; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.1); overflow: hidden; }
        .td-header { background-color: #0dcaf0; color: white; padding: 25px; text-align: center; }
        .td-header h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .td-header p { margin: 0; opacity: 0.9; }
        .content-section { padding: 30px; }
        .content-section h2 { color: #0dcaf0; border-bottom: 2px solid #e9ecef; padding-bottom: 10px; margin-bottom: 20px; }
        .question-container { border: 1px solid #e9ecef; border-radius: 8px; margin-bottom: 20px; overflow: hidden; }
        .question-header { background-color: #f8f9fa; padding: 15px 20px; border-bottom: 1px solid #e9ecef; }
        .question-title { font-weight: bold; font-size: 1.1rem; margin: 0; }
        .question-content { padding: 20px; }
        .solution-block { background-color: #f0f8f0; border-top: 1px solid #e9ecef; padding: 20px; display: none; }
        .btn-solution-toggle { background-color: #198754; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: background-color 0.3s; }
        .btn-solution-toggle:hover { background-color: #157347; }
        .code-block { background-color: #2d2d2d; color: #f8f8f2; border-radius: 5px; padding: 15px; margin: 15px 0; font-family: 'Courier New', Courier, monospace; font-size: 0.9rem; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; }
        .table-responsive { margin: 20px 0; }
        .table th { background-color: #0dcaf0; color: white; }
        .primary-key { text-decoration: underline; font-weight: bold; }
        .foreign-key { font-style: italic; color: #6c757d; }
    </style>
</head>
<body>
    <a href="../tds.html" style="margin: 10px 20px; display: inline-block;"><i class="fas fa-arrow-left"></i> Retour à la liste des TDs</a>
    
    <div class="td-container">
        <div class="td-header">
            <h1><i class="fas fa-bus"></i> Devoir de Contrôle N°3</h1>
            <p>Crédité à M. BEN JLIJEL Chakib - LYCEE SECONDAIRE ELHAOUARIA</p>
            <p>Classe : 4ème Sciences de l’informatique 2 - Date : 04-02-2025 - Durée : 1h</p>
        </div>

        <!-- Partie 1: Énoncé Complet -->
        <section class="content-section">
            <h2>Énoncé Exercice 2</h2>
            <p>En Tunisie, les réseaux de transport public sont essentiels pour assurer la mobilité des citoyens et la fluidité du trafic urbain. Un système de gestion des transports a été mis en place pour suivre en temps réel les informations relatives aux stations, aux bus, aux capteurs de performance et aux incidents éventuels. Ce système repose sur une base de données centralisée qui permet de superviser le bon fonctionnement du réseau, de détecter les anomalies, et de garantir un service de transport public efficace et sécurisé.</p>
            <p>La base de données « Gestion_transports » est décrite par la représentation textuelle simplifiée ci-dessous :</p>
            <div class="code-block">Station (<u>idStation</u>, nomStation, localisation, capacite)
Trafic (<u>dateTrafic, idStation#</u>, fluxPassagers)
Bus (<u>matBus</u>, etatBus, idStation#)
Capteur (<u>idCapt</u>, refCapt, matBus#)
Mesure (<u>numMes</u>, valMes, dateMes, idCapt#)
Alerte (<u>numAlert</u>, degAlert, statAlert, numMes#)</div>
            <p><em>Légende : <span class="primary-key">Clé primaire</span> | <span class="foreign-key">Clé étrangère#</span></em></p>
            <p>Les champs des tables sont décrits dans le tableau suivant :</p>
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead><tr><th>Champ</th><th>Description et type</th></tr></thead>
                    <tbody>
                        <tr><td>idStation</td><td>Identifiant unique de la station de transport, de type entier.</td></tr>
                        <tr><td>nomStation</td><td>Nom de la station de transport, de type chaîne de caractères.</td></tr>
                        <tr><td>localisation</td><td>Localisation de la station (par exemple, une adresse ou des coordonnées GPS), de type chaîne de caractères.</td></tr>
                        <tr><td>capacite</td><td>Capacité maximale d’accueil de la station (en nombre de passagers), de type entier.</td></tr>
                        <tr><td>dateTrafic</td><td>Date et heure du relevé des passagers.</td></tr>
                        <tr><td>fluxPassagers</td><td>Nombre de passagers enregistrés à une heure donnée, de type entier.</td></tr>
                        <tr><td>matBus</td><td>matricule d’un bus circulant dans le réseau, de type chaîne de caractères.</td></tr>
                        <tr><td>etatBus</td><td>État du bus, de type entier (0 = hors service, 1 = en service).</td></tr>
                        <tr><td>idCapt</td><td>Identifiant d’un capteur de bus, de type entier.</td></tr>
                        <tr><td>refCapt</td><td>Référence d’un capteur attaché à un bus, de type chaîne de caractères.</td></tr>
                        <tr><td>numMes</td><td>Numéro de la mesure, de type entier.</td></tr>
                        <tr><td>valMes</td><td>Valeur d’une mesure (par exemple, la température du moteur, la vitesse du bus, etc), de type réel.</td></tr>
                        <tr><td>dateMes</td><td>Date et heure de la mesure effectuée.</td></tr>
                        <tr><td>numAlert</td><td>Numéro d’une alerte, de type entier.</td></tr>
                        <tr><td>degAlert</td><td>Degré de l'alerte, de type entier (1 : avertissement, 2 : grave, 3 : critique).</td></tr>
                        <tr><td>statAlert</td><td>Statut de l'alerte, de type caractère ("R" : résolu, "A" : actif, "E" : en attente).</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Partie 2: Liste des Questions -->
        <section class="content-section">
            <h2>Liste des Questions</h2>

            <!-- MODIFICATION : Ajout de l'Exercice 1 (Web Dev) -->
            <h3>Exercice N° 1 (4 pts)</h3>
            <p>Dans un contexte de base de données et de développement Web et pour chacune des propositions ci-dessous, mettre une croix (X) dans la case correspondante à la réponse correcte.</p>
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead><tr><th></th><th>a</th><th>b</th><th>c</th></tr></thead>
                    <tbody>
                        <tr><td style="text-align:left">1) En HTML, quel est l'attribut utilisé pour désactiver un champ de saisie en lecture seule ?</td><td>disabled</td><td>readonly</td><td>inactive</td></tr>
                        <tr><td style="text-align:left">2) En JavaScript, la méthode qui permet de mettre en pause une vidéo est :</td><td>video.stop()</td><td>video.pause()</td><td>video.break()</td></tr>
                        <tr><td style="text-align:left">3) Quelle méthode JavaScript permet de modifier la couleur d'arrière-plan d'un élément HTML ?</td><td>element.background()</td><td>element.changeBackground()</td><td>element.style.backgroundColor</td></tr>
                        <tr><td style="text-align:left">4) En PHP, quelle est la fonction qui permet de générer un nombre aléatoire entre deux valeurs ?</td><td>random()</td><td>rand()</td><td>Math.random()</td></tr>
                        <tr><td style="text-align:left">5) Quel événement est déclenché lorsque la lecture d'une vidéo commence ?</td><td>onstart</td><td>onplay</td><td>onbegin</td></tr>
                        <tr><td style="text-align:left">6) Quelle fonction PHP permet de formater une date?</td><td>date()</td><td>time()</td><td>datetime()</td></tr>
                        <tr><td style="text-align:left">7) Quel événement est déclenché lorsque l'utilisateur commence à écrire dans un champ de saisie ?</td><td>onfocus</td><td>onclick</td><td>oninput</td></tr>
                        <tr><td style="text-align:left">8) En HTML, l'attribut max :</td><td>spécifie la valeur maximale d'un élément.</td><td>spécifie le nombre maximal de caractères autorisés.</td><td>définit le nombre maximal de colonnes d'un élément.</td></tr>
                    </tbody>
                </table>
            </div>
            <button class="btn-solution-toggle" onclick="toggleSolution('q_web1')">Afficher la correction</button>
            <div class="solution-block" id="solution-q_web1">
                <h4><i class="fas fa-lightbulb"></i> Correction</h4>
                <p>1) <strong>readonly</strong></p>
                <p>2) <strong>video.pause()</strong></p>
                <p>3) <strong>element.style.backgroundColor</strong></p>
                <p>4) <strong>rand()</strong></p>
                <p>5) <strong>onplay</strong></p>
                <p>6) <strong>date()</strong></p>
                <p>7) <strong>oninput</strong></p>
                <p>8) <strong>spécifie la valeur maximale d'un élément.</strong></p>
            </div>

            <h3>Exercice N° 2 (16 pts)</h3>
            
            <!-- Partie A -->
            <h4>Partie A : Manipulation des données et de la structure de la base</h4>
            
            <div class="question-container"><div class="question-header"><h3 class="question-title">1. Quels sont les bus en services de la station d'identifiant 12 ? On affichera le champ matBus.</h3></div><div class="question-content"><button class="btn-solution-toggle" onclick="toggleSolution('q1')">Afficher la correction</button><div class="solution-block" id="solution-q1"><h4><i class="fas fa-lightbulb"></i> Correction</h4><div class="file-name">SQL</div><div class="code-block">SELECT matBus
FROM Bus, Station
WHERE Bus.idStation = Station.idStation AND Station.idStation = 12 AND Bus.etatBus = 1;</div></div></div></div>

            <div class="question-container"><div class="question-header"><h3 class="question-title">2. Quels sont les capteurs qui ont généré des alertes de degré critique et dont le statut est non résolu ? On affichera les champs idCapt et refCapt.</h3></div><div class="question-content"><button class="btn-solution-toggle" onclick="toggleSolution('q2')">Afficher la correction</button><div class="solution-block" id="solution-q2"><h4><i class="fas fa-lightbulb"></i> Correction</h4><div class="file-name">SQL</div><div class="code-block">SELECT C.idCapt, C.refCapt
FROM Capteur C, Mesure M, Alerte A
WHERE C.matBus = M.matBus AND M.numMes = A.numMes AND A.degAlert = 3 AND A.statAlert = 'A';</div></div></div></div>

            <div class="question-container"><div class="question-header"><h3 class="question-title">3. Quel est le nombre total de passagers enregistrés à la date courante ? On affichera la colonne nombre total de passagers sous le format suivant "Nombre total de passagers".</h3></div><div class="question-content"><button class="btn-solution-toggle" onclick="toggleSolution('q3')">Afficher la correction</button><div class="solution-block" id="solution-q3"><h4><i class="fas fa-lightbulb"></i> Correction</h4><div class="file-name">SQL</div><div class="code-block">SELECT SUM(fluxPassagers) AS 'Nombre total de passagers'
FROM Trafic
WHERE DATE(dateTrafic) = DATE(NOW());</div></div></div></div>

            <div class="question-container"><div class="question-header"><h3 class="question-title">4. Quel est le nombre de bus hors service par station ? On affichera les champs idStation, nomStation ainsi que le nombre de bus trié par ordre décroissant.</h3></div><div class="question-content"><button class="btn-solution-toggle" onclick="toggleSolution('q4')">Afficher la correction</button><div class="solution-block" id="solution-q4"><h4><i class="fas fa-lightbulb"></i> Correction</h4><div class="file-name">SQL</div><div class="code-block">SELECT S.idStation, S.nomStation, COUNT(B.matBus)
FROM Station S, Bus B
WHERE S.idStation = B.idStation AND B.etatBus = 0
GROUP BY S.idStation, S.nomStation
ORDER BY COUNT(B.matBus) DESC;</div></div></div></div>

            <div class="question-container"><div class="question-header"><h3 class="question-title">5. Quelles sont les stations de transport susceptibles d’avoir un flux de passagers supérieur à 90% de leur capacité pendant le mois en cours de l’année 2025 ? On affichera, sans répétition, les champs idStation et nomStation.</h3></div><div class="question-content"><button class="btn-solution-toggle" onclick="toggleSolution('q5')">Afficher la correction</button><div class="solution-block" id="solution-q5"><h4><i class="fas fa-lightbulb"></i> Correction</h4><div class="file-name">SQL</div><div class="code-block">SELECT DISTINCT S.idStation, S.nomStation
FROM Station S, Trafic T
WHERE S.idStation = T.idStation
AND MONTH(T.dateTrafic) = MONTH(NOW())
AND YEAR(T.dateTrafic) = 2025
AND T.fluxPassagers > S.capacite * 0.9;</div></div></div></div>

            <div class="question-container"><div class="question-header"><h3 class="question-title">6. Quels sont les capteurs dont la dernière date de mesure est effectuée avant le 10 mars 2024 ? On affichera les champs idCapt, refCapt et la dernière date de mesure effectuée.</h3></div><div class="question-content"><button class="btn-solution-toggle" onclick="toggleSolution('q6')">Afficher la correction</button><div class="solution-block" id="solution-q6"><h4><i class="fas fa-lightbulb"></i> Correction</h4><div class="file-name">SQL</div><div class="code-block">SELECT C.idCapt, C.refCapt, MAX(M.dateMes)
FROM Capteur C, Mesure M
WHERE C.matBus = M.matBus
GROUP BY C.idCapt, C.refCapt
HAVING MAX(M.dateMes) &lt; '2024-03-10';</div></div></div></div>

            <div class="question-container"><div class="question-header"><h3 class="question-title">7. Pour alléger la base de données, supprimer les bus qui ne sont plus en service.</h3></div><div class="question-content"><button class="btn-solution-toggle" onclick="toggleSolution('q7')">Afficher la correction</button><div class="solution-block" id="solution-q7"><h4><i class="fas fa-lightbulb"></i> Correction</h4><div class="file-name">SQL</div><div class="code-block">DELETE FROM Bus
WHERE etatBus = 0;</div></div></div></div>

            <div class="question-container"><div class="question-header"><h3 class="question-title">8. En raison d'une erreur de calibration du capteur d’identifiant 7, augmenter de 5 unités les mesures enregistrées entre le 15 et le 20 janvier 2025.</h3></div><div class="question-content"><button class="btn-solution-toggle" onclick="toggleSolution('q8')">Afficher la correction</button><div class="solution-block" id="solution-q8"><h4><i class="fas fa-lightbulb"></i> Correction</h4><div class="file-name">SQL</div><div class="code-block">UPDATE Mesure
SET valMes = valMes + 5
WHERE idCapt = 7 AND dateMes BETWEEN '2025-01-15' AND '2025-01-20';</div></div></div></div>

            <!-- Partie B -->
            <h4>Partie B : Interprétation des requêtes</h4>

            <div class="question-container"><div class="question-header"><h3 class="question-title">9. En se basant sur l'extrait suivant des tables Station et Bus, donner le résultat de l'exécution de la requête suivante :</h3></div><div class="question-content"><div class="file-name">Requête</div><div class="code-block">SELECT matBus, etatBus
FROM Bus
WHERE idStation IN (SELECT idStation FROM Station WHERE capacite > 1500);</div>
            <!-- MODIFICATION : Ajout de la colonne idStation dans la table Bus -->
            <div class="table-responsive"><table class="table table-striped table-bordered"><thead><tr><th>idStation</th><th>nomStation</th><th>localisation</th><th>capacite</th></tr></thead><tbody><tr><td>10</td><td>parc H. THAMEUR</td><td>Rue d'Antioche, Tunis</td><td>2000</td></tr><tr><td>11</td><td>Ali BELHOUANE</td><td>Rue Bab El Khadra, Tunis</td><td>1500</td></tr><tr><td>12</td><td>place BARCELONE</td><td>Q5WJ+M53, Tunis</td><td>3000</td></tr><tr><td>13</td><td>Tunis - Marine</td><td>Rue Christophe Colombe</td><td>1000</td></tr></tbody></table></div><div class="table-responsive"><table class="table table-striped table-bordered"><thead><tr><th>matBus</th><th>etatBus</th><th>idStation</th></tr></thead><tbody><tr><td>B101</td><td>1</td><td>10</td></tr><tr><td>B102</td><td>0</td><td>11</td></tr><tr><td>B103</td><td>1</td><td>12</td></tr><tr><td>B104</td><td>1</td><td>13</td></tr><tr><td>B105</td><td>0</td><td>11</td></tr></tbody></table></div><button class="btn-solution-toggle" onclick="toggleSolution('q9')">Afficher la correction</button><div class="solution-block" id="solution-q9"><h4><i class="fas fa-lightbulb"></i> Correction</h4><div class="table-responsive"><table class="table table-striped table-bordered"><thead><tr><th>matBus</th><th>etatBus</th></tr></thead><tbody><tr><td>B101</td><td>1</td></tr><tr><td>B103</td><td>1</td></tr><tr><td>B104</td><td>1</td></tr></tbody></table></div></div></div>

            <div class="question-container"><div class="question-header"><h3 class="question-title">10. Expliquer le rôle de la requête précédente.</h3></div><div class="question-content"><button class="btn-solution-toggle" onclick="toggleSolution('q10')">Afficher la correction</button><div class="solution-block" id="solution-q10"><h4><i class="fas fa-lightbulb"></i> Correction</h4><p>Cette requête affiche les matricules et l'état de tous les bus qui sont affectés à des stations ayant une capacité supérieure à 1500.</p></div></div></div>

            <div class="question-container"><div class="question-header"><h3 class="question-title">11. Proposer une requête SQL équivalente à la requête précédente, sans utiliser l'opérateur IN.</h3></div><div class="question-content"><button class="btn-solution-toggle" onclick="toggleSolution('q11')">Afficher la correction</button><div class="solution-block" id="solution-q11"><h4><i class="fas fa-lightbulb"></i> Correction</h4><div class="file-name">SQL</div><div class="code-block">SELECT B.matBus, B.etatBus
FROM Bus B, Station S
WHERE B.idStation = S.idStation AND S.capacite > 1500;</div></div></div></div>

            <!-- MODIFICATION : Suppression de la question 12 -->
            
        </section>
    </div>

    <script>
        function toggleSolution(questionId) {
            const solutionBlock = document.getElementById(`solution-${questionId}`);
            const button = document.querySelector(`#${questionId} .btn-solution-toggle`);
            if (solutionBlock) {
                if (solutionBlock.style.display === 'block') {
                    solutionBlock.style.display = 'none';
                    button.textContent = 'Afficher la correction';
                } else {
                    solutionBlock.style.display = 'block';
                    button.textContent = 'Masquer la correction';
                }
            }
        }
    </script>
</body>
</html>